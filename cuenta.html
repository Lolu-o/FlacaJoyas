<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cuenta ‚Äî Las Flacas Joyas</title>
  <link rel="stylesheet" href="Estilos.css">
</head>

<body>

  <header class="topbar">
    <div class="container nav">
      <a class="brand" href="index.html" aria-label="Ir al inicio">
        <span>LA&nbsp;FLACA&nbsp;JOYAS¬Æ</span>
      </a>

      <div class="search">
        <a class="btn" href="carrito.html" aria-label="Ver carrito" style="padding: 0 12px; font-size: 1.2rem;">üõí</a>
      </div>

      <nav class="menu" aria-label="Principal">
        <a href="tienda.html">Tienda</a>
        <a href="colecciones.html">Colecciones</a>
        <a href="blog.html">Blog</a>
        <a href="ayuda.html">Ayuda</a>
        <a href="nosotros.html">Nosotros</a>
      </nav>

      <a href="cuenta.html" class="icon-btn icon-user" aria-label="Abrir cuenta">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="12" cy="7" r="4"></circle>
          <path d="M5.5 21a6.5 6.5 0 0 1 13 0"></path>
        </svg>
      </a>
    </div>
  </header>

  <main class="container" style="padding-top: 20px;">
    <div class="grid-3">
      
      <section class="card" style="grid-column: span 2;">
        <div style="display: flex; flex-wrap: wrap; gap: 40px;">
            
            <div style="flex: 1; min-width: 280px;">
                <h2 class="h2" style="margin-top:0; margin-bottom: 20px; font-size: 1.8rem; justify-content: flex-start;">Iniciar Sesi√≥n</h2>
                <p class="muted">Si ya tienes cuenta, ingresa aqu√≠.</p>
                
                <div class="field">
                    <label class="muted" for="email">Email</label>
                    <input id="email" class="input" placeholder="ejemplo@gmail.com" type="email">
                    <div id="login-error" style="color: var(--err); font-size: 0.85rem; display: none; margin-top: 5px;"></div>
                </div>
                
                <div class="field">
                    <label class="muted" for="pass">Contrase√±a</label>
                    <input id="pass" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button class="btn primary block" id="ing">Ingresar</button>
                <div style="margin-top: 15px; font-size: 0.85rem; color: #999;">
                  <em>Admin Demo: lasflacasjoyas@gmail.com / asd123</em>
                </div>
            </div>

            <div style="width: 1px; background: var(--border); display: none; @media(min-width: 768px){display:block;}"></div>

            <div style="flex: 1; min-width: 280px; border-top: 1px solid var(--border); padding-top: 20px; margin-top: -20px; 
                        border-left: 0; padding-left: 0;">
                <style>
                  @media(min-width: 780px) {
                    .col-registro { border-top: 0 !important; border-left: 1px solid var(--border) !important; padding-top: 0 !important; padding-left: 40px !important; margin-top: 0 !important; }
                  }
                </style>
                <div class="col-registro">
                  <h2 class="h2" style="margin-top:0; margin-bottom: 20px; font-size: 1.8rem; justify-content: flex-start;">Crear Cuenta</h2>
                  <p class="muted">¬øNueva aqu√≠? Reg√≠strate para guardar tus pedidos.</p>
                  
                  <div class="field">
                      <label class="muted" for="new-name">Nombre</label>
                      <input id="new-name" class="input" placeholder="Tu nombre">
                  </div>
                  <div class="field">
                      <label class="muted" for="new-email">Email</label>
                      <input id="new-email" class="input" placeholder="tucorreo@gmail.com" type="email">
                  </div>
                  <div class="field">
                      <label class="muted" for="new-pass">Contrase√±a</label>
                      <input id="new-pass" type="password" class="input" placeholder="Crea una clave">
                  </div>
                  
                  <button class="btn ghost block" id="reg">Registrarme</button>
                </div>
            </div>

        </div>
      </section>

      <section class="card">
        <h2 class="h2" style="margin-top:0; font-size: 1.5rem;">Mi Perfil</h2>
        
        <div id="perfil" class="muted" style="margin-bottom: 20px; padding: 10px; background: #f9f9f9; border-radius: 8px;">
            No autenticado.
        </div>
        
        <button class="btn" id="out" style="width:100%; margin-bottom: 20px;">Cerrar sesi√≥n</button>
        
        <hr style="border: 0; border-top: 1px solid var(--border); margin: 20px 0;">
        
        <h3 class="h2" style="font-size: 1.2rem; margin: 0 0 10px; justify-content: flex-start;">Mis pedidos</h3>
        <div id="orders" style="max-height: 300px; overflow-y: auto;">
            </div>
      </section>
      
    </div>
  </main>
<footer class="footer">
    <div class="container footer-grid">
      <div><strong>Las Flacas Joyas</strong>
        <p class="muted">Dise√±os √∫nicos en arcilla polim√©rica. Hecho a mano en Chile.</p>
      </div>
      <div>
        <small class="muted">Ayuda</small><br>
        <a href="ayuda.html">Env√≠os y devoluciones</a><br>
        <a href="politicas.html">Pol√≠ticas</a>
      </div>
      <div>
        <small class="muted">Contacto</small><br>
        <a href="contacto.html">Formulario & WhatsApp</a>
      </div>
      <div>
        <small class="muted">Cuenta</small><br>
        <a href="cuenta.html">Ingresar / Registro</a><br>
      </div>
    </div>
</footer>
  <script src="app.js"></script>
  <script>
    // --- 1. RENDERIZADO DEL ESTADO (Perfil y Pedidos) ---
    function render() {
      const u = getUser(); // Funci√≥n viene de app.js
      const perfilDiv = document.getElementById('perfil');
      const outBtn = document.getElementById('out');
      
      // Mostrar info del usuario si existe
      if (u) {
          perfilDiv.innerHTML = `
            <div style="font-weight:bold; color:var(--primary); font-size:1.1rem;">${u.nombre}</div>
            <div style="font-size:0.9rem;">${u.email}</div>
            <span class="tag" style="margin-top:5px; display:inline-block;">${u.rol.toUpperCase()}</span>
          `;
          outBtn.style.display = 'inline-flex';
      } else {
          perfilDiv.textContent = 'No has iniciado sesi√≥n.';
          outBtn.style.display = 'none'; // Ocultar bot√≥n cerrar sesi√≥n si no hay nadie
      }

      // Mostrar historial de pedidos (Simulado en localStorage)
      const list = JSON.parse(localStorage.getItem('lfj_orders_v1') || '[]');
      const ordersContainer = document.getElementById('orders');
      
      // Filtramos pedidos si no es admin (opcional, por ahora mostramos todos los locales del navegador)
      // En un sistema real, filtrar√≠as por u.email
      
      if(list.length === 0) {
          ordersContainer.innerHTML = '<p class="muted" style="font-size:0.9rem;">No tienes pedidos a√∫n.</p>';
      } else {
          ordersContainer.innerHTML = list.reverse().map(o => `
            <div class="notice" style="margin-bottom:8px; font-size:0.85rem; padding: 10px;">
                <strong>Pedido #${o.id}</strong><br>
                <span class="muted">${new Date(o.creado).toLocaleDateString()}</span><br>
                Estado: ${o.estado}
            </div>
          `).join('');
      }
    }
    
    // --- 2. L√ìGICA DE LOGIN (Ingresar) ---
    document.getElementById('ing').onclick = () => {
        const emailVal = document.getElementById('email').value;
        const passVal = document.getElementById('pass').value;
        const errDiv = document.getElementById('login-error');

        // Llamamos a login() de app.js (versi√≥n estricta)
        const user = login(emailVal, passVal);
        
        if (user) {
            // Login exitoso
            errDiv.style.display = 'none';
            window.location.href = 'index.html'; // Redirigir al inicio
        } else {
            // Error
            errDiv.textContent = "Usuario no registrado o contrase√±a incorrecta.";
            errDiv.style.display = 'block';
        }
    };

    // --- 3. L√ìGICA DE REGISTRO (Crear Cuenta) ---
    document.getElementById('reg').onclick = () => {
        const nameVal = document.getElementById('new-name').value;
        const emailVal = document.getElementById('new-email').value;
        const passVal = document.getElementById('new-pass').value;

        // Validaciones simples
        if(!nameVal || !emailVal || !passVal) {
            return alert('Por favor, completa todos los campos.');
        }
        if(!emailVal.includes('@')) {
            return alert('Ingresa un email v√°lido.');
        }

        // Llamamos a register() de app.js
        const result = register(nameVal, emailVal, passVal);
        
        if(result.ok) {
            alert('¬°Cuenta creada con √©xito! Bienvenido/a.');
            window.location.href = 'index.html'; // Redirigir logueado
        } else {
            alert('Error: ' + result.msg); // Ej: Email ya existe
        }
    };

    // --- 4. CERRAR SESI√ìN ---
    document.getElementById('out').onclick = () => { 
        logout(); 
        render(); 
    };
    
    // Inicializar vista al cargar
    render();
  </script>
</body>
</html>